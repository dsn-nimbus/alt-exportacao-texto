!function(o){"use strict";o.module("alt.exportacao-texto",[]).factory("AltExportacaoTextoModel",[function(){var o=function(o,t,e,a,r){this.titulos=o||void 0,this.infoNaoTabelada=r||void 0,this.propriedades=t||[],this.info=e||[],this.arquivoContabil=a||!1};return o}]).factory("AltExportacaoTextoParser",["AltExportacaoTextoModel",function(t){var e=function(o){return o instanceof t?void(this.expModelo=o):this.expModelo=new t};return e.prototype.parseArquivo=function(){var t=[],e=this.expModelo.titulos,a=this.expModelo.infoNaoTabelada,r=this.expModelo.propriedades,i=this.expModelo.info,n=!!this.expModelo.arquivoContabil,c=[],u=/\d+\.\d{1,2}/,p="%0A",l="%20";return a&&(a.forEach(function(o){o.forEach(function(t,e){/,/g.test(t)&&(o[e]='"'+t+'"')}),t.push(o)}),t.push([""],[""],[""])),e&&t.push(e),o.forEach(i,function(e){var a=[];o.forEach(r,function(t){if(o.isDefined(e[t])){var r=e[t];""===r?r='""':n?(r='"'+r+'"',u.test(r)&&/valor/.test(t)&&(r='"'+u.exec(r).join().replace(".",",")+'"')):/,/g.test(r)&&(r='"'+r+'"'),a.push(r)}}),t.push(a)}),o.forEach(t,function(o,t){c.push(o.join(","))}),c.join(p).replace(/ /g,l)},e}]).factory("AltExportacaoTextoExec",[function(){var o=function(o){this.document=o};return o.prototype.exporta=function(o,t,e){var a=this.document.createElement("a");a.href="data:attachment/"+e+";charset=utf-8,%EF%BB%BF"+o,a.target="_blank",a.download=t,this.document.body.appendChild(a),a.click(),this.document.body.removeChild(a)},o}]).directive("altExportacaoTexto",["AltExportacaoTextoModel","AltExportacaoTextoParser","AltExportacaoTextoExec",function(o,t,e){var a="A",r=function(a,r,i){var n=null,c=null,u=new e(document);r.on("click",function(){var e=a.tipoArquivo||"csv",r=a.nomeArquivo||"Exportação",i=a.preparaInfo();c=new o(i.titulos,i.propriedades,i.info,a.arquivoContabil,i.infoNaoTabelada),n=new t(c),u.exporta(n.parseArquivo(),r,e)})},i={nomeArquivo:"@",tipoArquivo:"@",arquivoContabil:"@",preparaInfo:"&"};return{restrict:a,link:r,scope:i}}])}(window.angular);