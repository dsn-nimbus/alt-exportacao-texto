!function(o){"use strict";o.module("alt.exportacao-texto",[]).factory("AltExportacaoTextoModel",[function(){var o=function(o,t,e,r,a){this.titulos=o||void 0,this.separador=a||",",this.propriedades=t||[],this.info=e||[],this.arquivoContabil=r||!1};return o}]).factory("AltExportacaoTextoParser",["AltExportacaoTextoModel",function(t){var e=function(o){return o instanceof t?void(this.expModelo=o):this.expModelo=new t};return e.prototype.parseArquivo=function(){var t=[],e=this.expModelo.titulos,r=this.expModelo.propriedades,a=this.expModelo.info,n=this.expModelo.separador,i=!!this.expModelo.arquivoContabil,c=[],p=/\d+\.\d{1,2}/,u=/\d/,s="\r\n";return e&&t.push(e),o.forEach(a,function(e){var a=[];o.forEach(r,function(t){if(o.isDefined(e[t])){var r=e[t];""===r?r='""':i?(r='"'+r+'"',p.test(r)&&/valor/.test(t)&&(r='"'+p.exec(r).join().replace(".",",")+'"')):r=u.test(r)?'"'+String(r).replace(".",",")+'"':'"'+r+'"',a.push(r)}}),t.push(a)}),o.forEach(t,function(o,t){c.push(o.join(n))}),c.join(s)},e}]).factory("AltExportacaoTextoExec",[function(){var o=function(o){this.document=o};return o.prototype.exporta=function(o,t,e){var r=this.document.createElement("a");r.href="data:attachment/"+e+";charset=utf-8,%EF%BB%BF"+encodeURIComponent(o),r.target="_blank",r.download=t,this.document.body.appendChild(r),r.click(),this.document.body.removeChild(r)},o}]).directive("altExportacaoTexto",["AltExportacaoTextoModel","AltExportacaoTextoParser","AltExportacaoTextoExec",function(o,t,e){return{restrict:"A",link:function(r,a,n){var i=null,c=null,p=new e(document);a.on("click",function(){var e=r.tipoArquivo||"csv",a=r.nomeArquivo||"Exportação",n=r.preparaInfo();c=new o(n.titulos,n.propriedades,n.info,r.arquivoContabil,r.separador),i=new t(c),p.exporta(i.parseArquivo(),a,e)})},scope:{nomeArquivo:"@",tipoArquivo:"@",arquivoContabil:"@",separador:"@",preparaInfo:"&"}}}])}(window.angular);