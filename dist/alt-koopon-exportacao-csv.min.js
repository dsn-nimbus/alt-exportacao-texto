!function(o){"use strict";o.module("alt.koopon.exportacao-csv",[]).factory("AltKooponExportacaoModel",[function(){var o=function(o,t,a,n,e){this.titulos=o||void 0,this.infoNaoTabelada=e||void 0,this.propriedades=t||[],this.info=a||[],this.arquivoContabil=n||!1};return o}]).factory("AltKooponExportacaoParser",["AltKooponExportacaoModel",function(t){var a=function(o){return o instanceof t?void(this.expModelo=o):this.expModelo=new t};return a.prototype.parseArquivo=function(){var t=[],a=this.expModelo.titulos,n=this.expModelo.infoNaoTabelada,e=this.expModelo.propriedades,r=this.expModelo.info,i=!!this.expModelo.arquivoContabil,p=[],c=/\d+\.\d{1,2}/,u="%0A",l="%20";return n&&(n.forEach(function(o){t.push(o)}),t.push([""],[""],[""])),a&&t.push(a),o.forEach(r,function(a){var n=[];o.forEach(e,function(t){if(o.isDefined(a[t])){var e=a[t];""===e?e='""':i?(e='"'+e+'"',c.test(e)&&/valor/.test(t)&&(e='"'+c.exec(e).join().replace(".",",")+'"')):/,/g.test(e)&&(e='"'+e+'"'),n.push(e)}}),t.push(n)}),o.forEach(t,function(o,t){p.push(o.join(","))}),p.join(u).replace(/ /g,l)},a}]).factory("AltKooponExportacaoExec",[function(){var o=function(o){this.document=o};return o.prototype.exporta=function(o,t,a){var n=this.document.createElement("a");n.href="data:attachment/"+a+";charset=utf-8,%EF%BB%BF"+o,n.target="_blank",n.download=t,this.document.body.appendChild(n),n.click(),this.document.body.removeChild(n)},o}]).directive("altKooponExportacaoCsv",["AltKooponExportacaoModel","AltKooponExportacaoParser","AltKooponExportacaoExec",function(o,t,a){var n="A",e=function(n,e,r){var i=null,p=null,c=new a(document);e.on("click",function(){var a=n.tipoArquivo||"csv",e=n.nomeArquivo||"Exportação",r=n.preparaInfo();p=new o(r.titulos,r.propriedades,r.info,n.arquivoContabil,r.infoNaoTabelada),i=new t(p),c.exporta(i.parseArquivo(),e,a)})},r={nomeArquivo:"@",tipoArquivo:"@",arquivoContabil:"@",preparaInfo:"&"};return{restrict:n,link:e,scope:r}}])}(window.angular);