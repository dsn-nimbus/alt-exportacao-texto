!function(o){"use strict";o.module("alt.koopon.exportacao-csv",[]).factory("AltKooponExportacaoModel",[function(){var o=function(o,t,n,r){this.titulos=o||void 0,this.propriedades=t||[],this.info=n||[],this.arquivoContabil=r||!1};return o}]).factory("AltKooponExportacaoParser",["AltKooponExportacaoModel",function(t){var n=function(o){return o instanceof t?void(this.expModelo=o):this.expModelo=new t};return n.prototype.parseArquivo=function(){var t=[],n=this.expModelo.titulos,r=this.expModelo.propriedades,e=this.expModelo.info,a=!!this.expModelo.arquivoContabil,i=[],p=/\d+\.\d{1,2}/,c="%0A",u="%20";return n&&t.push(n),o.forEach(e,function(n){var e=[];o.forEach(r,function(t){if(o.isDefined(n[t])){var r=n[t];""===r?r='""':a&&(r='"'+r+'"',r=p.test(r)&&/valor/.test(t)?'"'+p.exec(r).join().replace(".",",")+'"':r),e.push(r)}}),t.push(e)}),o.forEach(t,function(o,t){i.push(o.join(","))}),i.join(c).replace(/ /g,u)},n}]).factory("AltKooponExportacaoExec",[function(){var o=function(o){this.document=o};return o.prototype.exporta=function(o,t,n){var r=this.document.createElement("a");r.href="data:attachment/"+n+","+o,r.target="_blank",r.download=t,this.document.body.appendChild(r),r.click(),this.document.body.removeChild(r)},o}]).directive("altKooponExportacaoCsv",["AltKooponExportacaoModel","AltKooponExportacaoParser","AltKooponExportacaoExec",function(o,t,n){var r="A",e=function(r,e,a){var i=r.tipoArquivo||"csv",p=r.nomeArquivo||"Exportação",c=null,u=null,l=new n(document);e.on("click",function(){var n=r.preparaInfo();u=new o(n.titulos,n.propriedades,n.info,r.arquivoContabil),c=new t(u),l.exporta(c.parseArquivo(),p,i)})},a={nomeArquivo:"@",tipoArquivo:"@",arquivoContabil:"@",preparaInfo:"&"};return{restrict:r,link:e,scope:a}}])}(window.angular);